
<div class="row mt-4 justify-content-center text-center">
    <div class="col col-12">
        <app-info-section title="Account History" bodyMsg="This page shows the balance history of each of your accounts over time.
            Use the grids to review detailed changes and the graphs to visualize trends, growth, and fluctuations.
            Balance records are automatically added every few hours.">
        </app-info-section>
    </div>
</div>

<div class="container mt-4">
    <div *ngIf="(personalRecords$ | async)?.length === 0">
        <h3 class="mb-3">No Accounts Connected Yet</h3>
            <p class="text-muted mb-4">
                Add your checking, savings, or retirement accounts to start
                tracking your net worth and financial progress.
            </p>

            <button class="btn btn-primary btn-lg" (click)="navToAddAcount()">
                Add Your First Account
            </button>
    </div>
    @for (rec of personalRecords$ | async; track rec) {
    <details #d open (toggle)="onToggle()">
        <summary class="text-start no-arrow" style="cursor: pointer;">
            <div class="row mt-4 d-flex" style="border-bottom: 2px dashed black;">
                <div class="col col-6 text-start">
                    <h4>
                        <i *ngIf="d.open" class="fa-solid fa-angle-down"></i>
                        <i *ngIf="!d.open" class="fa-solid fa-chevron-right"></i>
                        {{ rec.Name }}
                    </h4>
                </div>
                <div class="col col-6 text-end">
                    <h4>
                        Balance: {{formatCurrency(rec.Balance)}}
                    </h4>
                </div>
            </div>
        </summary>
        <div class="row mt-4" style="height: 30rem;">
            <div class="col col-4">
                <div style="max-height: 30rem; overflow-y: auto;">
                    <table class="table table-bordered table-hover mt-4" style="width: 90%;">
                        <thead class="thead-dark">
                            <th>Date</th>
                            <th>Time</th>
                            <th>Balance</th>
                        </thead>
                        <tbody>
                            <tr *ngFor="let record of rec.Records">
                                <td>{{record.RecordedDate| date:'MM/dd/yyyy'}}</td>
                                <td>{{record.RecordedDate| date:'h:mm a'}}</td>
                                <td>{{formatCurrency(record.Balance)}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="col col-8">
                <canvas *ngIf="rec.ChartRecords" baseChart [data]="rec.ChartRecords" [options]="accountHistoryChartOptions" type="line">
                </canvas>
            </div>
        </div>
        <hr />
    </details>
    }
</div>