<div class="row mt-4 justify-content-center text-center">
  <div class="col-12 col-md-10 col-lg-8">
    <app-info-section
      title="Account History"
      bodyMsg="This page shows the balance history of each of your accounts over time.
               Use the grids to review detailed changes and the graphs to visualize trends, growth, and fluctuations.
               Balance records are automatically added every few hours.">
    </app-info-section>
  </div>
</div>

<div class="container mt-4" *ngIf="(personalRecords$ | async)?.length === 0">
  <div class="text-center no-accounts">
    <h3 class="mb-3">No Accounts Connected Yet</h3>
    <p class="text-muted mb-4">
      Add your checking, savings, or retirement accounts to start tracking your net worth and financial progress.
    </p>
    <button class="btn btn-primary btn-lg" (click)="navToAddAcount()">
      Add Your First Account
    </button>
  </div>
</div>

<div class="container mt-4">
    @for (rec of personalRecords$ | async; track rec) {
    <details #d open (toggle)="onToggle()" class="account-details">
      <summary class="summary-header" style="cursor: pointer;">
        <div class="row align-items-center border-bottom dashed-border py-2">
          <div class="col-6 text-start">
            <h4>
              <i *ngIf="d.open" class="fa-solid fa-angle-down"></i>
              <i *ngIf="!d.open" class="fa-solid fa-chevron-right"></i>
              {{ rec.Name }}
            </h4>
          </div>
          <div class="col-6 text-end">
            <h4>Balance: {{ formatCurrency(rec.Balance) }}</h4>
          </div>
        </div>
      </summary>

      <div class="row mt-3 flex-column flex-lg-row account-content">
        <div class="col-12 col-lg-4 mb-3 mb-lg-0">
          <div class="table-responsive" style="max-height: 30rem;">
            <table class="table table-bordered table-hover mb-0">
              <thead class="table-dark">
                <tr>
                  <th>Date</th>
                  <th>Time</th>
                  <th>Balance</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let record of rec.Records">
                  <td>{{ record.RecordedDate | date:'MM/dd/yyyy' }}</td>
                  <td>{{ record.RecordedDate | date:'h:mm a' }}</td>
                  <td>{{ formatCurrency(record.Balance) }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="col-12 col-lg-8">
          <canvas *ngIf="rec.ChartRecords" 
                  baseChart 
                  [data]="rec.ChartRecords" 
                  [options]="accountHistoryChartOptions" 
                  type="line">
          </canvas>
        </div>
      </div>
      <hr />
    </details>
    }
</div>
